# 项目架构设计

## 一、总体架构概述

本项目基于 Electron + Vue 3 + IndexedDB 技术栈，旨在实现跨平台的桌面端应用，支持本地数据高效管理，并通过 WebDAV、iCloud 等云服务实现数据同步。架构设计强调前后端分离、数据本地优先、云端同步可选，兼顾易用性与扩展性。

## 二、目录结构说明

项目主要目录结构如下：

- `src/main/`：Electron 主进程相关代码，负责应用生命周期、窗口管理、系统集成、与云服务（WebDAV、iCloud）交互等。
- `src/main/electron/`：主进程下的各类服务模块（如 ai-service-manager、webdav-service、icloud-service 等），实现具体的系统能力和云服务对接。
- `src/renderer/`：前端渲染进程，基于 Vue 3，负责 UI 展示、用户交互、业务逻辑等。
- `src/shared/`：主进程与渲染进程共享的类型定义和工具方法。
- `test/`：各类单元测试与集成测试。
- `build/`、`scripts/`、`docs/` 等：构建资源、脚本和文档。

## 三、数据架构设计（核心）

### 1. 本地数据存储：IndexedDB

前端渲染进程（Vue 3）通过 IndexedDB 进行本地数据持久化。IndexedDB 具备高性能、结构化存储能力，适合桌面端离线场景。所有用户数据（如笔记、配置、缓存等）默认优先存储于本地 IndexedDB。

### 2. 云端同步：WebDAV & iCloud

Electron 主进程通过 webdav-service、icloud-service 等模块，负责与 WebDAV、iCloud 等云服务进行数据同步。同步流程如下：

1. 渲染进程通过 IPC（进程间通信）向主进程发起同步请求。
2. 主进程调用对应的云服务模块，将本地 IndexedDB 数据导出、上传至云端，或从云端拉取数据并回写本地。
3. 同步过程中的冲突、合并、错误处理均在主进程侧完成，保证数据一致性和安全性。

### 3. 数据流与分工

- **IndexedDB**：负责本地数据的高效读写，支持离线使用。
- **Electron 主进程**：作为桥梁，负责本地与云端的数据同步、加密、备份等操作。
- **WebDAV/iCloud**：作为远程存储后端，提供数据的云端备份与多端同步能力。

### 4. 设计要点与易混淆点

- IndexedDB 仅在本地浏览器环境（渲染进程）可用，主进程无法直接访问。
- 云端同步由主进程统一调度，避免多端并发写入导致的数据冲突。
- 数据同步采用“本地优先”策略，用户可自主触发同步，最大程度保障数据安全与可控性。

## 四、各模块职责与协作

- **主进程（src/main/）**：
  - 应用生命周期管理
  - 云服务集成（WebDAV、iCloud）
  - 数据同步调度与冲突处理
  - 与渲染进程的 IPC 通信
- **渲染进程（src/renderer/）**：
  - UI 展示与交互
  - 本地数据管理（IndexedDB）
  - 向主进程发起同步、设置等请求
- **shared（src/shared/）**：
  - 类型定义、工具函数、常量等

## 五、架构选型说明

1. **Electron**：提供跨平台桌面端壳，便于系统级能力扩展。
2. **Vue 3**：提升前端开发效率与可维护性。
3. **IndexedDB**：本地高性能存储，适合离线场景。
4. **WebDAV/iCloud**：主流云服务，便于数据同步与备份。

## 六、总结

本架构兼顾了本地数据的高效管理与云端同步的灵活性，分工明确，易于扩展。数据架构设计以“本地优先、云端同步”为核心理念，确保数据安全、用户体验与系统可维护性。
